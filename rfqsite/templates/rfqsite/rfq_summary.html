<!doctype html>
{% load static %}
<html class="fixed">
	<head>

		<!-- Basic -->
		<meta charset="UTF-8">

		<title>RFQ Management Application</title>
		<meta name="keywords" content="HTML5 Admin Template">
		<meta name="description" content="Porto Admin - Responsive HTML5 Template">
		<meta name="author" content="okler.net">

		<!-- Mobile Metas -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<!-- Web Fonts  -->
		<link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800|Shadows+Into+Light" rel="stylesheet" type="text/css">

		<!-- Vendor CSS -->
		<link rel="stylesheet" href="{% static "assets/vendor/bootstrap/css/bootstrap.css" %}">
		<link rel="stylesheet" href="{% static "assets/vendor/font-awesome/css/font-awesome.css" %}">
		<link rel="stylesheet" href="{% static "assets/vendor/magnific-popup/magnific-popup.css" %}">
		<link rel="stylesheet" href="{% static "assets/vendor/bootstrap-datepicker/css/datepicker3.css" %}">

		<!-- DataTable CSS -->
		<link rel="stylesheet" href="{% static "assets/vendor/select2/select2.css" %}">
		<link rel="stylesheet" href="{% static "assets/vendor/jquery-datatables-bs3/assets/css/datatables.css" %}">

		<!-- Theme CSS -->
		<link rel="stylesheet" href="{% static "assets/stylesheets/theme.css" %}">

		<!-- Skin CSS -->
		<link rel="stylesheet" href="{% static "assets/stylesheets/skins/default.css" %}">

		<!-- Theme Custom CSS -->
		<link rel="stylesheet" href="{% static "assets/stylesheets/theme-custom.css" %}">
	</head>
	<body>
		<section class="body">

			<!-- start: header -->
			{% include 'navbar.html' %}
			<!-- end: header -->

			<div class="inner-wrapper">
				<!-- start: sidebar -->
				{% include 'leftsidebar.html' %}
				<!-- end: sidebar -->

				<section role="main" class="content-body">
					<header class="page-header">
						<h2>RFQ Summary</h2>
						<div class="right-wrapper pull-right">
							<ol class="breadcrumbs">
								<li>
									<a href="/part_table/{{ project.tracker_no }}">
										<i class="fa fa-chevron-left"></i><b> Back</b>
									</a>
								</li>
							</ol>
							<a class="sidebar-right-toggle"></a>
						</div>
					</header>

					<!-- start: page -->
					<section class="panel">
						<header class="panel-heading">
							<div class="panel-actions">
								<!-- <a href="#" class="fa fa-caret-down"></a>
								<a href="#" class="fa fa-times"></a> -->
							</div>
							<h2 class="panel-title">RFQ Summary</h2>
						</header>
						<div class="panel-body">
							<div class="form-group">
								<label class="col-sm-3 control-label text-right"><b>USD/THB</b></label>
								<div class="col-sm-9">
									<label class="control-label" id="usd-thb" name="usd-thb">{{ project.usd_thb }}</label>
								</div>
							</div>
							<!-- Total Project Cost -->
							<div class="table-responsive">
								<table class="table table-bordered table-striped table-condensed mb-none">
										<thead>
											<th class="center custom1" colspan="6" scope="colgroup">Total Project Cost</th>
											<tr>
												<th class="center custom1"></th>
												<th class="center custom2">Total Cost</th>
												<th class="center custom2">Mtl Cost</th>
												<th class="center custom2">Spl Process Cost</th>
												<th class="center custom2">Total Hardware Cost</th>
												<th class="center custom2">Total Machine Cost</th>
											</tr>
										</thead>
										<tbody>
											<tr>
												<td class="center custom1">Per Years (USD)</td>
												<td class="center" id="total-cost-td" name="total-cost-td">{{ total_cost_td }}</td>
												<td class="center" id ="mtl-cost-td" name ="mtl-cost-td">{{ mtl_cost_td }}</td>
												<td class="center" id="spl-process-cost-td" name="spl-process-cost-td">{{ spl_process_cost_td }}</td>
												<td class="center" id="total-hardware-cost-td" name="total-hardware-cost-td">{{ total_hardware_cost_td }}</td>
												<td class="center" id="total-machine-cost-td" name="total-machine-cost-td">{{ total_machine_cost_td }}</td>
												<td class="center" id="total-cost-td2" name="total-cost-td2" hidden>{{ total_cost_td }}</td>
												<td class="center" id ="mtl-cost-td2" name ="mtl-cost-td2" hidden>{{ mtl_cost_td }}</td>
												<td class="center" id="spl-process-cost-td2" name="spl-process-cost-td2" hidden>{{ spl_process_cost_td }}</td>
												<td class="center" id="total-hardware-cost-td2" name="total-hardware-cost-td2" hidden>{{ total_hardware_cost_td }}</td>
												<td class="center" id="total-machine-cost-td2" name="total-machine-cost-td2" hidden>{{ total_machine_cost_td }}</td>
											</tr>
											<tr>
												<td class="center custom1">Per Years (‎THB)</td>
												<td class="center" id="total-cost-tb" name="total-cost-tb">-</td>
												<td class="center" id ="mtl-cost-tb" name ="mtl-cost-tb">-</td>
												<td class="center" id="spl-process-cost-tb" name="spl-process-cost-tb">-</td>
												<td class="center" id="total-hardware-cost-tb" name="total-hardware-cost-tb">-</td>
												<td class="center" id="total-machine-cost-tb" name="total-machine-cost-tb">-</td>
											</tr>
											<tr>
												<td class="center custom1">X/Total Cost (%)</td>
												<td class="center" id="total-cost-p" name="total-cost-p">-</td>
												<td class="center" id ="mtl-cost-p" name ="mtl-cost-p">-</td>
												<td class="center" id="spl-process-cost-p" name="spl-process-cost-p">-</td>
												<td class="center" id="total-hardware-cost-p" name="total-hardware-cost-p">-</td>
												<td class="center" id="total-machine-cost-p" name="total-machine-cost-p">-</td>
											</tr>
											<tr>
												<td class="center custom1">Value A (%)</td>
												<td class="center" id="value-a" name="value-a" colspan="5">-</td>
											</tr>
										</tbody>
								</table>
							</div>
							<hr>
							<!-- Machining Capacity Required for the Project -->
							<input type="number" id="mc-set-size" name="mc-set-size" value="{{ mc_set.count }}" hidden>
							<div class="table-responsive">
								<table class="table table-bordered table-striped table-condensed mb-none">
									<thead>
										<th class="center custom1" colspan="4" scope="colgroup">Machining Capacity Required for the Project</th>
										<tr>
											<th class="center custom2">Name</th>
											<th class="center custom2">Per Year</th>
											<th class="center custom2">M/C's / Yr</th>
											<th class="center custom2">Manpower / Yr</th>
										</tr>
									</thead>
									<tbody>
										{% for mc in mc_set %}
										<tr>
											<td class="center"><b>{{ mc.act_id.mc_id.name }}</b></td>
											<td class="center" id="mcrftp-total-{{ forloop.counter0 }}" name="mcrftp-total-{{ forloop.counter0 }}">-</td>
											<td class="center" id="mcrftp-mpy-{{ forloop.counter0 }}" name="mcrftp-mpy-{{ forloop.counter0 }}">-</td>
											<td class="center" id="mcrftp-man-{{ forloop.counter0 }}" name="mcrftp-man-{{ forloop.counter0 }}">-</td>
										</tr>
										{% endfor %}
										{% if mc_set.count == 0 %}<tr><td class="center" colspan="3">This RFQ has no machining process.</td></tr>{% endif %}
									</tbody>
								</table>
							</div>
						</div>
					</section>
					<!-- end: page -->
				</section>
			</div>
		</section>
	</body>
	<!-- Head Libs -->
	<script src="{% static "assets/vendor/modernizr/modernizr.js" %}"></script>

	<!-- Vendor -->
	<script src="{% static "assets/vendor/jquery/jquery.js" %}"></script>
	<script src="{% static "assets/vendor/jquery-browser-mobile/jquery.browser.mobile.js" %}"></script>
	<script src="{% static "assets/vendor/bootstrap/js/bootstrap.js" %}"></script>
	<script src="{% static "assets/vendor/nanoscroller/nanoscroller.js" %}"></script>
	<script src="{% static "assets/vendor/bootstrap-datepicker/js/bootstrap-datepicker.js" %}"></script>
	<script src="{% static "assets/vendor/magnific-popup/magnific-popup.js" %}"></script>
	<script src="{% static "assets/vendor/jquery-placeholder/jquery.placeholder.js" %}"></script>

	<!-- DataTable JS -->
	<script src="{% static "assets/vendor/select2/select2.js" %}"></script>
	<script src="{% static "assets/vendor/jquery-datatables/media/js/jquery.dataTables.js" %}"></script>
	<script src="{% static "assets/vendor/jquery-datatables/extras/TableTools/js/dataTables.tableTools.min.js" %}"></script>
	<script src="{% static "assets/vendor/jquery-datatables-bs3/assets/js/datatables.js" %}"></script>

	<!-- Theme Base, Components and Settings -->
	<script src="{% static "assets/javascripts/theme.js" %}"></script>

	<!-- Theme Custom -->
	<script src="{% static "assets/javascripts/theme.custom.js" %}"></script>

	<!-- Theme Initialization Files -->
	<script src="{% static "assets/javascripts/theme.init.js" %}"></script>

	<script>
	$( document ).ready(function() {
		data_cal();
	});

	function data_cal(){
		// -*-*-*-*-*-*-*-*-*-*- 1 RAW INPUT SAVE PHASE -*-*-*-*-*-*-*-*-*-*-
		var usd_thb = parseFloat($( "#usd-thb" ).text()); // NO RESTATE
		// -- Total Project Cost --
		var total_cost_td  = parseFloat($( "#total-cost-td2" ).text());
		var mtl_cost_td  = parseFloat($( "#mtl-cost-td2" ).text());
		var spl_process_cost_td = parseFloat($( "#spl-process-cost-td2" ).text());
 		var total_hardware_cost_td  = parseFloat($( "#total-hardware-cost-td2" ).text());
		var total_machine_cost_td = parseFloat($( "#total-machine-cost-td2" ).text());

		// -- Machining Capacity Required for the Project --
		var mc_set_size = $( "#mc-set-size" ).val();
		var arr_mcrftp_total = [];
		for(var i = 0; i < mc_set_size;i++){
			var text = "#mcrftp-total-" + i;
			arr_mcrftp_total[i] =  parseFloat($( text ).text());
		}

		// -*-*-*-*-*-*-*-*-*-*- 2 CALCULATE VALUE SAVE PHASE -*-*-*-*-*-*-*-*-*-*-
		// -- Total Project Cost --
		// Per Year (THB) = Total Project Cost * USD Per THB
		var total_cost_tb = total_cost_td * usd_thb;
		var mtl_cost_tb = mtl_cost_td * usd_thb;
		var spl_process_cost_tb = spl_process_cost_td * usd_thb;
 		var total_hardware_cost_tb = total_hardware_cost_td * usd_thb;
		var total_machine_cost_tb = total_machine_cost_td * usd_thb;

		// X/Total Cost (%)
		var mtl_cost_p = (mtl_cost_td / total_cost_td) * 100;
		var spl_process_cost_p = (spl_process_cost_td / total_cost_td) * 100;
		var total_hardware_cost_p = (total_hardware_cost_td / total_cost_td) * 100;
		var total_machine_cost_p = (total_machine_cost_td / total_cost_td) * 100;

		// -- Machining Capacity Required for the Project --
		// Machines Per Year = Machining Capacity Required for the Project / 5000
		// Man Power Per Year = Round Up ( Machining Capacity Required for the Project / 5000 )
		var arr_mcrftp_mpy = [];
		var arr_mcrftp_man = [];
		for(var i = 0; i < mc_set_size;i++){
			arr_mcrftp_mpy[i] =  arr_mcrftp_total[i] / 5000;
			arr_mcrftp_man[i] =  Math.ceil(arr_mcrftp_total[i] / 5000);
		}

		// -*-*-*-*-*-*-*-*-*-*- 5 RAW INPUT RESTATE-2 PHASE -*-*-*-*-*-*-*-*-*-*-
		// -- Total Project Cost --
		$( "#total-cost-td" ).text(dollar_sign(total_cost_td) + math_fix(total_cost_td));
		$( "#mtl-cost-td" ).text(dollar_sign(mtl_cost_td) + math_fix(mtl_cost_td));
		$( "#spl-process-cost-td" ).text(dollar_sign(spl_process_cost_td) + math_fix(spl_process_cost_td));
		$( "#total-hardware-cost-td" ).text(dollar_sign(total_hardware_cost_td) + math_fix(total_hardware_cost_td));
		$( "#total-machine-cost-td" ).text(dollar_sign(total_machine_cost_td) + math_fix(total_machine_cost_td));

		// -- Machining Capacity Required for the Project --
		for(var i = 0; i < mc_set_size;i++){
			var text = "#mcrftp-total-" + i;
			$( text ).text(math_fix(arr_mcrftp_total[i]));
		}

		// -*-*-*-*-*-*-*-*-*-*- 6 CALCULATE VALUE RESTATE-2 PHASE -*-*-*-*-*-*-*-*-*-*-
		// -- Total Project Cost --
		$( "#total-cost-tb" ).text(bath_sign(total_cost_tb) + math_fix(total_cost_tb));
		$( "#mtl-cost-tb" ).text(bath_sign(mtl_cost_tb) + math_fix(mtl_cost_tb));
		$( "#spl-process-cost-tb" ).text(bath_sign(spl_process_cost_tb) + math_fix(spl_process_cost_tb));
		$( "#total-hardware-cost-tb" ).text(bath_sign(total_hardware_cost_tb) + math_fix(total_hardware_cost_tb));
		$( "#total-machine-cost-tb" ).text(bath_sign(total_machine_cost_tb) + math_fix(total_machine_cost_tb));

		$( "#mtl-cost-p" ).text(math_fix(mtl_cost_p) + percent_sign(mtl_cost_p));
		$( "#spl-process-cost-p" ).text(math_fix(spl_process_cost_p) + percent_sign(spl_process_cost_p));
		$( "#total-hardware-cost-p" ).text(math_fix(total_hardware_cost_p) + percent_sign(total_hardware_cost_p));
		$( "#total-machine-cost-p" ).text(math_fix(total_machine_cost_p) + percent_sign(total_machine_cost_p));

		// -- Machining Capacity Required for the Project --
		for(var i = 0; i < mc_set_size;i++){
			var text = "#mcrftp-mpy-" + i;
			$( text ).text(math_fix(arr_mcrftp_mpy[i]));
			var text = "#mcrftp-man-" + i;
			$( text ).text(math_fix(arr_mcrftp_man[i]));
		}
		// -*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
	}

	function dollar_sign(value){
		if(isNaN(value)) return "";
		return "$";
	}

	function bath_sign(value){
		if(isNaN(value)) return "";
		return "฿";
	}

	function percent_sign(value){
		if(isNaN(value)) return "";
		return "%";
	}

	function math_fix(value){
		if(isNaN(value)) return value;
		return value.toFixed(2);
		// return Math.round((value + Number.EPSILON) * 100) / 100;
	}

	</script>

	<!-- DataTable Default -->
	<script>
	(function( $ ) {
		'use strict';
		var datatableInit = function() {
			$('#datatable-default').dataTable();
		};
		$(function() {
			datatableInit();
		});
	}).apply( this, [ jQuery ]);
	</script>

</html>
